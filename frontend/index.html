<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>Audio Summarizer</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200..800&family=Noto+Sans+Hebrew:wght@100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">

  
</head>

<body class="container-sm py-4">
  <h1 class="mb-4 text-center">ğŸ§ ×”×¢×œ××ª ×§×•×‘×¥ ×©××¢</h1>

  <div class="mb-3">
    <input type="file" id="file-upload" accept="audio/*" class="form-control" />
  </div>
  <button id="upload-btn" class="btn btn-lg w-100">×”×¢×œ×”</button>
  <div id="status-message" class="mt-3 text-muted text-center"></div>

  <!-- Progress wheel HTML -->
  <div id="progress-wrapper" class="text-center my-3" style="display:none;" role="status" aria-live="polite">
    <div id="progress-wheel" style="width:220px; height:220px; margin:0 auto; position:relative;">
      <div class="progress-wrap" aria-hidden="false" role="img" aria-label="×”×ª×§×“××•×ª ×¢×™×‘×•×“">
        <!-- ×‘×¡×™×¡ ××—×•×œ×§ ×œ×©×œ×•×©×” ×¡×§×˜×•×¨×™× -->
        <div class="ring-base"></div>

        <!-- ×©×›×‘×ª ×”××™×œ×•×™ ×”×“×™× ××™×ª (JS ×™×¢×“×›×Ÿ ××ª ×”×¨×§×¢ ×©×œ×”) -->
        <div id="ringProgress" class="ring-progress"></div>

        <!-- ×˜×§×¡×˜ ×‘××¨×›×– (JS ×™×¢×“×›×Ÿ ××ª #progressTime ×•â€‘#progressLabel) -->
        <div class="progress-center">
          <div id="progressTime" class="progress-time">--:--</div>
          <div id="progressLabel" class="progress-label">××•×¢×¨×š ×œ×”×©×œ××”</div>
        </div>
      </div>

      <!-- legend (×¦×‘×¢×™× ×ª×•×××™× ×œ×¦×‘×¢×™ ×”××¢×’×œ×™×) -->
      <div id="progress-legend" class="mt-2" style="font-size:13px; display:flex; justify-content:center; gap:12px; align-items:center;">
        <span><span class="sw" style="background:var(--pre-color)"></span>×¢×™×‘×•×“ ××§×“×™×</span>
        <span><span class="sw" style="background:var(--trans-color)"></span>×ª××œ×•×œ ×•××™×–×•×’</span>
        <span><span class="sw" style="background:var(--sum-color)"></span>×™×¦×™×¨×ª ×¡×™×›×•×</span>
      </div>
    </div>
  </div>
  <!-- end progress wheel -->

  <div id="summary-container" class="card shadow mt-4">
    <div class="card-header text-end text-secondary" style="font-size:14px; background-color:#b0f1e7;">
      ×¡×™×›×•× ×”×ª×•×›×Ÿ ×©×œ ×”×§×•×‘×¥ ×©××¢ ×©×”×•×¢×œ×”
    </div>
    <div class="card-body">
      <div id="summary-text"></div>
      <button id="download-btn" class="btn mt-3">ğŸ“„ ×”×•×¨×“ ×›â€‘PDF</button>
    </div>
  </div>
<!-- ======= ×˜×¢×™× ×ª ×¡×§×¨×™×¤×˜×™× (×¤×¢× ××—×ª ×‘×œ×‘×“) ======= -->
<!-- upload.js × ×˜×¢×Ÿ ××—×¨×™ ×”××œ×× ×˜×™× -->
<script src="upload.js"></script>

<!-- ×¡×¤×¨×™×•×ª × ×•×¡×¤×•×ª (×˜×¢×Ÿ ××•×ª×Ÿ ×¤×¢× ××—×ª ×‘×œ×‘×“) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="font-loader.js"></script>

<!-- ======= ××ª×—×•×œ fallback, ×—×™×‘×•×¨ ×›×¤×ª×•×¨ ×•×—×©×™×¤×ª setProgress ======= -->
<script>
  (function () {
    // Guard ×œ×× ×™×¢×ª ××ª×—×•×œ ×›×¤×•×œ
    if (window.__progressInitDone) {
      console.debug('Progress init already done');
      return;
    }
    window.__progressInitDone = true;
  
    // ×¢×–×¨ ×‘×˜×™×—×•×ª×™ ×œ×§×‘×œ×ª ××œ×× ×˜×™×
    function $id(id) { return document.getElementById(id); }
  
    // --- initProgressFallback: ××ª×—×•×œ ××¦×‘ ×”×ª×—×œ×ª×™ ×œâ€‘ringProgress ×× ×¦×¨×™×š ---
    function initProgressFallback() {
      const ring = $id('ringProgress');
      const wrapper = $id('progress-wrapper');
      if (!ring) return;
      // ×¨×§×¢ ×¨×™×§ (×©×§×•×£) â€” ×œ× ××¦×™×’ ××ª ×”×•×•×™×“×’'×˜ ×›×‘×¨×™×¨×ª ××—×“×œ
      ring.style.background = 'conic-gradient(transparent 0deg 360deg)';
      if (wrapper) wrapper.style.display = 'none';
      console.debug('Progress fallback initialized');
    }
    // ×”×¨×¦×” ××—×¨×™ DOM ××•×›×Ÿ
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      setTimeout(initProgressFallback, 0);
    } else {
      document.addEventListener('DOMContentLoaded', initProgressFallback);
    }
  
    // --- attachUploadBtn: ×—×™×‘×•×¨ ×‘×˜×•×— ×©×œ ×›×¤×ª×•×¨ ×”×”×¢×œ××” (×¢× guard) ---
    function attachUploadBtn() {
      const uploadBtn = $id('upload-btn');
      if (!uploadBtn) {
        console.warn('attachUploadBtn: upload-btn not found; skipping');
        return;
      }
      if (uploadBtn.dataset.uploadBtnAttached) {
        console.debug('attachUploadBtn: already attached');
        return;
      }
      uploadBtn.dataset.uploadBtnAttached = '1';
  
      uploadBtn.addEventListener('click', () => {
        const summaryContainer = $id('summary-container');
        if (summaryContainer) summaryContainer.style.display = 'none';
        if (typeof updateStatus === 'function') updateStatus("××ª×—×™×œ ×”×¢×œ××” ×•×¢×™×‘×•×“...");
        // upload.js ×××•×¨ ×œ×˜×¤×œ ×‘×”×¢×œ××” ×¢×¦××” (presign + PUT)
      });
    }
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      setTimeout(attachUploadBtn, 0);
    } else {
      document.addEventListener('DOMContentLoaded', attachUploadBtn);
    }
  
    // --- setProgress: ×—×©×™×¤×” ×’×œ×•×‘×œ×™×ª ×œ×¢×“×›×•×Ÿ ×˜×‘×¢×ª ×”â€‘3 ×¡×§×˜×•×¨×™× (conic-gradient) ---
    function clamp(v) { return Math.max(0, Math.min(100, Number(v) || 0)); }
  
    /**
     * setProgress(pre, trans, sum, show, etaMinutes)
     * pre/trans/sum: 0..100
     * show: ×× true â€” ×”×¦×’ ××ª ×”×•×•×™×“×’'×˜ ×’× ×× ×”×¢×¨×›×™× 0
     * etaMinutes: ×–××Ÿ ××©×•×¢×¨ ×©××•×¢×‘×¨ ××‘×—×•×¥
     */
    function setProgress(pre = 0, trans = 0, sum = 0, show = false, etaMinutes = null) {
      pre = clamp(pre); trans = clamp(trans); sum = clamp(sum);
      console.debug(">>> setProgress called", {
        prePct: pre,
        transPct: trans,
        sumPct: sum,
        show,
        etaMinutes
      });

      // ×—×™×©×•×‘ ×–×•×•×™×•×ª ×œ×›×œ ×¡×§×˜×•×¨ (120deg ×œ×›×œ ×©×œ×‘)
      const sectorDeg = 360 / 3;
      const a1 = (pre / 100) * sectorDeg;
      const a2 = a1 + (trans / 100) * sectorDeg;
      const a3 = a2 + (sum / 100) * sectorDeg;

      console.debug(">>> setProgress angles", { a1, a2, a3 });

      // ×¦×‘×¢×™× ×â€‘CSS variables (fallback ×× ×œ× ××•×’×“×¨×™×)
      const rootStyle = getComputedStyle(document.documentElement);
      const preColor = (rootStyle.getPropertyValue('--pre-color') || '#ffd6e6').trim();
      const transColor = (rootStyle.getPropertyValue('--trans-color') || '#ffe6b3').trim();
      const sumColor = (rootStyle.getPropertyValue('--sum-color') || '#c8f7e9').trim();

      console.debug(">>> setProgress colors", { preColor, transColor, sumColor });

      // ×‘×•× ×™× ××ª ×”â€‘conic-gradient ×¨×§ ×× ×™×© ×—×œ×§×™× ×œ×¦×‘×•×¢
      const stops = [];
      if (a1 > 0) stops.push(`${preColor} 0deg ${a1}deg`);
      if (a2 > a1) stops.push(`${transColor} ${a1}deg ${a2}deg`);
      if (a3 > a2) stops.push(`${sumColor} ${a2}deg ${a3}deg`);

      const ring = $id('ringProgress');
      if (ring) {
        if (stops.length > 0) {
          stops.push(`transparent ${a3}deg 360deg`);
          ring.style.background = `conic-gradient(${stops.join(', ')})`;
          console.debug(">>> setProgress ring background", ring.style.background);
        } else {
          ring.style.background = 'conic-gradient(transparent 0deg 360deg)';
          console.debug(">>> setProgress ring background empty");
        }
      }

      // ×¢×“×›×•×Ÿ ×˜×§×¡×˜ ××¨×›×–×™ â€” ETA ×©××•×¢×‘×¨ ××‘×—×•×¥
      const timeEl = $id('progressTime');
      if (timeEl) {
        timeEl.textContent = etaMinutes !== null ? `${etaMinutes} ×“×§'` : 'â€”';
        console.debug(">>> setProgress ETA text", timeEl.textContent);
      }

      // ×ª×•×•×™×ª ×©×œ×‘ ×œ×¤×™ ×”×”×ª×§×“××•×ª
      const labelEl = $id('progressLabel');
      let label = '×××ª×™×Ÿ ×œ×¢×™×‘×•×“';
      if (sum > 0) label = '××›×™×Ÿ ×¡×™×›×•×';
      else if (trans > 0) label = '××ª××œ×œ ×•×××–×’';
      else if (pre > 0) label = '××¢×‘×“ ××§×˜×¢×™×';
      if (labelEl) {
        labelEl.textContent = label;
        console.debug(">>> setProgress label text", labelEl.textContent);
      }

      // ×”×¦×’×”: ×¨×§ ×× show=true ××• ×× ×™×© ×”×ª×§×“××•×ª ×××©×™×ª (>0)
      const wrapper = $id('progress-wrapper');
      if (wrapper) {
        if (show || pre > 0 || trans > 0 || sum > 0) {
          wrapper.style.display = 'block';
          console.debug(">>> setProgress wrapper shown");
        } else {
          wrapper.style.display = 'none';
          console.debug(">>> setProgress wrapper hidden");
        }
      }
    }

    // ×—×©×™×¤×” ×’×œ×•×‘×œ×™×ª
    window.setProgress = setProgress;

  })();
</script>




<!-- ×× ×™×© ×œ×š CSS ×—×™×¦×•× ×™, ×”×©××™×¨×™ ××•×ª×•; ××—×¨×ª ×”×•×¡×™×¤×™ ××ª ×”â€‘CSS ×©×¡×™×›×× ×• -->
<style>
  /* clean-styles.css
   ×§×•×‘×¥ CSS ××¡×•×“×¨ ×•××—×™×“ ×¢×‘×•×¨ ×”×××©×§ (××™×Ÿ ×›×¤×™×œ×•×™×•×ª) */
:root{
  /* ×¦×‘×¢×™× ××¨×›×–×™×™× */
  --bg-page: #b0f1e7;
  --accent: #ff2167;
  --accent-hover: #e01b5a;

  --pre-color: #ffd6e6;
  --trans-color: #ffe6b3;
  --sum-color: #c8f7e9;

  --pre-color-full: #ff9bbf;
  --trans-color-full: #ffb84d;
  --sum-color-full: #00a86b;

  --ring-size: 220px;
  --ring-width: 15px;
  --ring-transition: 400ms;
  --text-muted: #555;
  --text-accent: #00796b;
}

/* ×‘×¡×™×¡×™ */
html,body{
  height:100%;
  margin:0;
  padding:0;
  box-sizing:border-box;
}
*,*::before,*::after{ box-sizing:inherit; }

body{
  font-family: "Assistant", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  direction: rtl;
  background-color: var(--bg-page);
  min-height:100vh;
  color:#222;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* ×›×•×ª×¨×ª ×¨××©×™×ª */
h1{
  font-family: "Rubik", "Assistant", sans-serif;
  color:#fff;
  font-weight:900;
  text-shadow:2px 2px 4px rgba(0,0,0,0.45);
  margin:0 0 1rem 0;
  text-align:center;
}

/* ×›×¤×ª×•×¨ ×”×¢×œ××” */
#upload-btn{
  display:inline-block;
  width:100%;
  background-color:var(--accent);
  color:#fff;
  border:0;
  padding:.9rem 1rem;
  font-size:1.05rem;
  font-weight:700;
  border-radius:6px;
  cursor:pointer;
  transition: transform .18s ease, background-color .18s ease;
}
#upload-btn:hover{ transform:scale(1.03); background-color:var(--accent-hover); }

/* ×¡×˜×˜×•×¡ ×˜×§×¡×˜ */
#status-message{
  margin-top:.75rem;
  text-align:center;
  color:var(--text-muted);
  font-size:0.95rem;
}

/* ====== Progress ring (conic-gradient approach) ====== */
.progress-wrap{
  width:var(--ring-size);
  height:var(--ring-size);
  position:relative;
  margin:0 auto;
}

/* ×‘×¡×™×¡ ××—×•×œ×§ ×œ×©×œ×•×©×” ×¡×§×˜×•×¨×™× (××§×¨× ×¡×˜×˜×™) */
.ring-base{
  width:100%;
  height:100%;
  border-radius:50%;
  background:
    conic-gradient(
      var(--pre-color) 0deg 120deg,
      var(--trans-color) 120deg 240deg,
      var(--sum-color) 240deg 360deg
    );
  /* ×—×™×ª×•×š ××¨×›×–×™ ×œ×™×¦×™×¨×ª ×˜×‘×¢×ª */
  -webkit-mask: radial-gradient(farthest-side, transparent calc(50% - var(--ring-width)), black calc(50% - var(--ring-width)));
  mask: radial-gradient(farthest-side, transparent calc(50% - var(--ring-width)), black calc(50% - var(--ring-width)));
  transform: rotate(-90deg); /* ×”×ª×—×œ×” ×‘×¦×¤×•×Ÿ-××–×¨×— */
}

/* ×©×›×‘×ª ×”××™×œ×•×™ ×”×“×™× ××™×ª (JS ×™×¢×“×›×Ÿ ××ª ×”â€‘background) */
.ring-progress{
  position:absolute;
  inset:0;
  border-radius:50%;
  pointer-events:none;
  transform:rotate(-90deg);
  background: conic-gradient(transparent 0deg 360deg);
  transition: background var(--ring-transition) ease;
  -webkit-mask: radial-gradient(farthest-side, transparent calc(50% - var(--ring-width)), black calc(50% - var(--ring-width)));
  mask: radial-gradient(farthest-side, transparent calc(50% - var(--ring-width)), black calc(50% - var(--ring-width)));
}

/* ×˜×§×¡×˜ ××¨×›×–×™ ××¢×œ ×”×˜×‘×¢×ª */
.progress-center{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  pointer-events:none;
  text-align:center;
}
.progress-time{ font-weight:700; color:var(--text-accent); font-size:1.05rem; }
.progress-label{ color:var(--text-muted); font-size:0.95rem; margin-top:.35rem; }

/* ××§×¨× */
.legend{
  margin-top:.75rem;
  display:flex;
  gap:12px;
  justify-content:center;
  align-items:center;
  font-size:0.95rem;
}
.legend .sw{ width:12px; height:12px; display:inline-block; border-radius:2px; }
.legend span{ display:inline-flex; gap:8px; align-items:center; }

/* ====== Summary container & download ====== */
#summary-container{
  margin-top:1.25rem;
  background:#fff;
  border-radius:8px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  display:none; /* ××•×¡×ª×¨ ×‘×”×ª×—×œ×” */
  animation: fadeIn .9s ease both;
  overflow:hidden;
}
#summary-container .card-header{
  background-color:#00CED1;
  color:#fff;
  font-weight:700;
  font-size:0.95rem;
  padding:.6rem 1rem;
}
#summary-container .card-body{ padding:1rem; color:#222; }
#download-btn{
  background:var(--accent);
  color:#fff;
  border:0;
  padding:.5rem .75rem;
  border-radius:6px;
  cursor:pointer;
}
#download-btn:hover{ background:var(--accent-hover); transform:scale(1.02); }

/* ====== SVG arcs (if used elsewhere) ====== */
#progress-wheel{ width:var(--ring-size); height:var(--ring-size); margin:0 auto; position:relative; z-index:1; }
#progress-wheel svg circle{ transition: stroke-dasharray 600ms ease, stroke 400ms ease; vector-effect: non-scaling-stroke; }
#arc-pre{ stroke:var(--pre-color); stroke-width:8; stroke-linecap:butt; }
#arc-trans{ stroke:var(--trans-color); stroke-width:8; stroke-linecap:butt; }
#arc-sum{ stroke:var(--sum-color); stroke-width:8; stroke-linecap:butt; }

/* ×¦×‘×¢×™× ××œ××™× (× ×™×ª×Ÿ ×œ×”×•×¡×™×£/×œ×”×¡×™×¨ ××—×œ×§×•×ª ×‘â€‘JS) */
.arc-full-pre{ stroke:var(--pre-color-full) !important; }
.arc-full-trans{ stroke:var(--trans-color-full) !important; }
.arc-full-sum{ stroke:var(--sum-color-full) !important; }

/* ×¢×–×¨×™ ×× ×™××¦×™×” ×•×“×™××’× ×•×¡×˜×™×§×” */
@keyframes fadeIn{ from{ opacity:0; transform:translateY(12px); } to{ opacity:1; transform:none; } }
.debug-show-progress #progress-wrapper{ display:block !important; }

/* × ×’×™×©×•×ª ×§×˜× ×” */
[role="status"]{ outline: none; }
[aria-live]{ /* keep screen readers informed */ }

/* ×¡×’× ×•×Ÿ ×¨×¡×¤×•× ×¡×™×‘×™ ×§×˜×Ÿ */
@media (max-width:420px){
  :root{ --ring-size: 180px; --ring-width:16px; }
  .progress-time{ font-size:16px; }
  .progress-label{ font-size:12px; }
  #upload-btn{ padding:.75rem; font-size:1rem; }
}

</style>